.container_16

  %h4
    Add your photos
  %h6#status_message
    You need to upload <span id="photos_needed">3</span> more photos (at least).

  =stylesheet_link_tag 'photocracy/uploadify'
  =javascript_include_tag 'photocracy/swfobject.js', 'photocracy/jquery.uploadify.v2.1.0.min.js'

  :javascript
    $(document).ready(function() {
    	$("#uploadify").uploadify({
    		'uploader'       : '/javascripts/photocracy/uploadify.swf',
    		'script'         : 'upload_photos',
    		'cancelImg'      : '/images/photocracy/cancel.png',
    		'queueID'        : 'fileQueue',
    		'auto'           : true,
    		'multi'          : true,
        'fileDesc'       : 'Only jpg, png, and gif files allowed',
        'fileExt'        : '*.jpg;*.jpeg;*.png;*.gif',
    		'buttonText'     : 'UPLOAD PHOTOS',
    		'width'          : '222',
    		'height'         : '48',
    		'wmode'          : 'transparent',
    		'buttonImg'      : '/images/photocracy/upload_photos.png',
    		scriptData       : {
          'session_identifier' : "#{request.session_options[:id]}",
          'authenticity_token'  : AUTH_TOKEN
        },
        onComplete       : function() {
          var photos_needed = decrement($('#photos_needed').text());
          if (photos_needed > 0) {
            $('#photos_needed').text(photos_needed);
          } else {
            $('#status_message').text("You've uploaded the minimum, but the more you add the better!");
            $('#done_button').show();
          }
        }
    	});
    });

  .margin_bottom
    #fileQueue
    %form
      %input{:type => 'file', :name => 'uploadify', :id => 'uploadify'}
    %p
      Tip: Hold down your 'shift' key when selecting photos<br /> to upload more than one at a time.

  #done_button{:style => 'display:none;'}
    #{button_to 'Done Uploading, go to survey', '/' + @earl.name.to_s}
  / <p><a href="javascript:jQuery('#uploadify').uploadifyClearQueue()">Cancel All Uploads</a></p>