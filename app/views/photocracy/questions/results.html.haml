=render :partial => "shared/highcharts_header"

.container_12
  #primary_content
    #hd.center
      %h1.no_margin
        %span.normal
          Results of
        =h @question.name
      %p.gray
        View the results of the survey here or
        =link_to 'return to voting.',  url_for(:action => :show, :controller => :earls, :id => params[:id])
    
    .grid_4
      %ul#graphs.results
        %li
          =link_to 'Top photos', results_question_url(:id => params[:id]), :class => 'active'
        -[{:title => :scatter_ideas_title, :link => 'scatter_plot_user_vs_seed_ideas', :type => 'scatter_ideas', :div_id => 'scatter_ideas-chart-container', :response_type => 'script'},
         {:title => :world_map_title, :link => 'voter_map', :type => 'votes', :response_type => 'html', :div_id => 'voter_map'}].each do |graph|
          %li
            =link_to t("results.#{graph[:title]}"),
                      url_for(:action => graph[:link], :type => graph[:type]),
                      :div_id => graph[:div_id], :response_type => graph[:response_type], :class => 'ajax_graph'
          
        %br
        =link_to 'Â« Back to voting', url_for(:action => :show, :controller => :earls, :id => params[:id]), :class => 'blue button'
    
    .grid_8
      .target
        -@choices.each_with_index do |choice, i|
          -photo = Photo.find(choice.data)
          %a.float_left.photo_frame{:style => "background:#fff url('#{photo.image.url(:medium)}') center center no-repeat;width:70%;margin-bottom:3em;", :href => photo.image.url, :target => '_blank'}
            -if choice == @choices.first
              =image_tag('photocracy/blue_ribbon.png')
        
          .float_left{:style => 'width:20%'}
            RANKING
            %h4 
              =(i + 1).ordinalize

            VOTES
            %h4 
              =choice.attributes["wins"] + choice.attributes["losses"]

            SCORE
            %h4 
              =choice.attributes['score'].round.to_s + '%'
          
            -if choice == @choices.first
              .gray
                %i
                  The score of a photo is the chance that it will win against a randomly chosen photo.
          .clear
        -if !params[:more] && (@question.attributes['choices_count'].to_i > 10)
          =link_to(t('nav.see_all_ideas'), url_for(:action => :results, :controller => :questions, :id => params[:id], :more => true))
        -if params[:more]
          = paginated = will_paginate @choices, :previous_label => I18n.t('results.previous'), :next_label => I18n.t('results.next') 
    .clear